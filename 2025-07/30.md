# Today I Learned (2025-07-30)

ì´ ì €ì¥ì†ŒëŠ” ì œê°€ ë§¤ì¼ í•™ìŠµí•œ ë‚´ìš©ì„ ê¸°ë¡í•˜ê³  ì •ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“  ê³µê°„ì…ë‹ˆë‹¤. ê¸°ìˆ ì ì¸ ê°œë…, ì‹¤ìŠµí•˜ë©´ì„œ ë§ˆì£¼ì¹œ ë¬¸ì œë“¤, ì •ë¦¬í•˜ê³  ì‹¶ì€ ê°œë…ë“¤ì„ ì£¼ì œë³„/ì¼ìë³„ë¡œ êµ¬ì¡°í™”í•˜ì—¬ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“š ê³µë¶€í•œ ë‚´ìš©
**[Java] ReentrantLock, Synchronized, CAS ì‚´í´ë³´ê¸°**

í–‰ì‚¬ í”„ë¡œì íŠ¸ì—ì„œ ëŒ€ì–‘ì˜ ì‚¬ìš©ìê°€ ë„ì…í•˜ëŠ” ê²½ìš° ì—°ì¥ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ ê³ ë ¤í•´ ReentrantLock, synchronized, CAS ê¸°ìˆ ì„ ì‚´í´ë³´ë©° ì •ë¦¬í–ˆë‹¤.

- ReentrantLock
  - `fair(true)` ì˜µì…˜ì„ í†µí•´ ê³µì •í•œ ëŒ€ê¸° ê´€ë¦¬ ê°€ëŠ¥
  - ë‹¨ì¼ ì´ìš©ìì— ëŒ€í•œ `userLockMap` + ì „ì²´ ëŒ€í˜• ê´€ë¦¬ `globalLock`
  - ì´ë¦„ì²´: AQS(AbstractQueuedSynchronizer)
  - FIFO ëŒ€ê¸° í–‰ë³µ í‚¤ìš°, ê° ìŠ¤ë ˆë“œì— ëŒ€í•´ tryLock(), isHeldByCurrentThread() ë“± ê²€ì‚¬ ê°€ëŠ¥

```java
ReentrantLock globalLock = new ReentrantLock();
userLock.lock();
try {
    globalLock.lock();
    try {
        // ë‹¨ë… ì§€ì • ë…¸ë ¥
    } finally {
        globalLock.unlock();
    }
} finally {
    userLock.unlock();
}
```

- synchronized ë³´ë‹¤ ReentrantLockì´ íš¨ìœ¨ì ì¸ ì´ìœ 
  - synchronizedëŠ” OS-level blocking
  - ReentrantLockì€ user-level ëŒ€ê¸° í‚¤ìš° ëª©ë¡ ì‚¬ìš©
  - JVMì—ì„œ ì°¨ì§€ë¡œ ë” ê°œì„ ëœë‹¤

> synchronized: ì—¬ë¦„ì¥ì—ì„œ ì¼ë°˜ ì£¼ì„ì— ë“¤ì–´ê°€ëŠ” ê²ƒ ê°™ì€ ì‹.
> ReentrantLock: í‹°ì»· í”„ë¦¬ ì‹œìŠ¤í…œì—ì„œ ë·°ë¡œ í‚¤ ë³´ê³  ì¡°ì‘.

- CAS (Compare-And-Swap)
  - ì €ì£¼ì—ì„œ AtomicInteger ê°™ì€ í˜•íƒœë¡œ êµ¬í˜„
  - í˜„ì¬ ê°’ê³¼ ê³„ì‚°ì„ ë¹„êµí•´ ê°’ì„ ê·œì •ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì›ìì  ì—°ì‚°

```java
AtomicInteger count = new AtomicInteger(1000);
if (count.compareAndSet(expected, expected - 1)) {
    // ì²´í¬ì™€ ê°’ ë°”ê¾¸ê¸° ì„±ê³µ
}
```

- ì§€ì†ì ìœ¼ë¡œ CPUì—ì„œ ê²€ì‚¬ê°€ ìˆ˜í–‰ë˜ëŠ” ë°©ì‹ì´ë©°, Busy-wait-loop ë°©ì‹ìœ¼ë¡œ ê±´ê°• ìƒí™©ì—ì„œ íš¨ê³¼ì 
- ê·¸ëŸ¬ë‚˜ ê²½ìŸì´ ê°•í•´ì§€ê³ , ë…¸ë ¥ ì‹œê°„ì´ ê¸´ ê²½ìš°ì—ëŠ” íœ˜ë‘ì§€ë©´ ì„±ëŠ¥ íƒ€ê²©

## ğŸ’¡ ì£¼ìš” ê°œë…ë“¤
- ReentrantLockì€ synchronizedë³´ë‹¤ í¸ê°€ìŠ¤ëŸ¬ì›Œì§„ ë¦¬ì–¼íŠ¸ì´ë©°, ìœ ì‹¬íˆ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- CASëŠ” ë‚´ë¶€ì ìœ¼ë¡œ í´ë˜ìŠ¤ ë˜ëŠ” CPU ë‹¨ì–´ ìˆ˜ì¤€ì˜ í™˜ê²½ì—ì„œ ìœ ë‹ˆí¬ í¬ìŠ¤íŠ¸ ê°’ ë°”ê¾¸ê¸°ì— ëŒ€í•œ íš¨ê³¼ì ì¸ ê²ƒì„ ë³´ì—¬ì¤€ë‹¤.

## ğŸ”— ì°¸ê³ 
- [Java Doc: ReentrantLock](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/locks/ReentrantLock.html)
- [AtomicInteger CAS ì‹œê°„ì„œ](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html)


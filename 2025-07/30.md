# Today I Learned (2025-07-30)

ì´ ì €ì¥ì†ŒëŠ” ì œê°€ ë§¤ì¼ í•™ìŠµí•œ ë‚´ìš©ì„ ê¸°ë¡í•˜ê³  ì •ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“  ê³µê°„ì…ë‹ˆë‹¤. ê¸°ìˆ ì ì¸ ê°œë…, ì‹¤ìŠµí•˜ë©´ì„œ ë§ˆì£¼ì¹œ ë¬¸ì œë“¤, ì •ë¦¬í•˜ê³  ì‹¶ì€ ê°œë…ë“¤ì„ ì£¼ì œë³„/ì¼ìë³„ë¡œ êµ¬ì¡°í™”í•˜ì—¬ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“š ê³µë¶€í•œ ë‚´ìš©
**[Java] ReentrantLock, Synchronized, CAS ì‚´í´ë³´ê¸°**

í–‰ì‚¬ í”„ë¡œì íŠ¸ì—ì„œ ëŒ€ì–‘ì˜ ì‚¬ìš©ìê°€ ë„ì…í•˜ëŠ” ê²½ìš° ì—°ì¥ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ ê³ ë ¤í•´ ReentrantLock, synchronized, CAS ê¸°ìˆ ì„ ì‚´í´ë³´ë©° ì •ë¦¬í–ˆë‹¤.

- ReentrantLock
  - `fair(true)` ì˜µì…˜ì„ í†µí•´ ê³µì •í•œ ëŒ€ê¸° ê´€ë¦¬ ê°€ëŠ¥
  - ë‹¨ì¼ ì´ìš©ìì— ëŒ€í•œ `userLockMap` + ì „ì²´ ëŒ€í˜• ê´€ë¦¬ `globalLock`
  - ì´ë¦„ì²´: AQS(AbstractQueuedSynchronizer)
  - FIFO ëŒ€ê¸° íë¡œ ê° ìŠ¤ë ˆë“œì— ëŒ€í•´ tryLock(), isHeldByCurrentThread() ë“± ê²€ì‚¬ ê°€ëŠ¥

```java
ReentrantLock globalLock = new ReentrantLock();
userLock.lock();
try {
    globalLock.lock();
    try {
        // ë‹¨ë… ì§€ì • ë…¸ë ¥
    } finally {
        globalLock.unlock();
    }
} finally {
    userLock.unlock();
}
```

- synchronized ë³´ë‹¤ ReentrantLockì´ ë™ì‹œì„± ê²½í•©ì´ ë§ì„ ë•Œ íš¨ìœ¨ì ì¸ ì´ìœ 
  - synchronizedëŠ” OS-level blocking
  - ReentrantLockì€ user-level ëŒ€ê¸° íë¥¼ ì´ìš©
  - JVM ìµœì í™”ë¡œ synchronizedê°€ ì¡°ê¸ˆ ë” low-levelì´ë¼ ì„±ëŠ¥ì´ ë” ì¢‹ì€ ë¶€ë¶„ì´ ìˆë‹¤


- CAS (Compare-And-Swap)
  - ìë°”ì—ì„œ AtomicInteger ê°™ì€ í˜•íƒœë¡œ êµ¬í˜„
  - í˜„ì¬ ê°’ê³¼ ê³„ì‚°ì„ ë¹„êµí•´ ê°’ì„ ê·œì •ê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì›ìì  ì—°ì‚°

```java
AtomicInteger count = new AtomicInteger(1000);
if (count.compareAndSet(expected, expected - 1)) {
    // ì²´í¬ì™€ ê°’ ë°”ê¾¸ê¸° ì„±ê³µ
}
```

- ì§€ì†ì ìœ¼ë¡œ CPUì—ì„œ ê²€ì‚¬ê°€ ìˆ˜í–‰ë˜ëŠ” ë°©ì‹ì´ë©°, Busy-wait-loop ë°©ì‹ìœ¼ë¡œ ê±´ê°• ìƒí™©ì—ì„œ íš¨ê³¼ì 
- ê·¸ëŸ¬ë‚˜ ê²½ìŸì´ ê°•í•´ì§€ê³ , ë…¸ë ¥ ì‹œê°„ì´ ê¸´ ê²½ìš°ì—ëŠ” íœ˜ë‘ì§€ë©´ ì„±ëŠ¥ íƒ€ê²©

## ğŸ”— ì°¸ê³ 
- [Java Doc: ReentrantLock](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/locks/ReentrantLock.html)
- [AtomicInteger CAS ì‹œê°„ì„œ](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html)


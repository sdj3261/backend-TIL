# [Spring] λ™μ‹μ„± ν…μ¤νΈ - (2) Redis
π“… 2025-06-17  
π”— μ°Έκ³ μλ£: [https://new-think-think.tistory.com/35](https://new-think-think.tistory.com/35)  

## π“ κ³µλ¶€ν• λ‚΄μ©
Redisλ¥Ό μ΄μ©ν• λ¶„μ‚° ν™κ²½μ—μ„μ λ™μ‹μ„± μ μ–΄ μ‹¤μµ  
- Lettuce κΈ°λ°μ `spinlock + setNx`
- Redisson κΈ°λ°μ `pub-sub κΈ°λ° λ½` λ° `κ³µμ • λ½`

## π’΅ μ£Όμ” κ°λ…λ“¤

### β… λ¶„μ‚° λ½
- μ—¬λ¬ μ‹μ¤ν…μ—μ„ κ³µμ  μμ› μ ‘κ·Όμ„ μ μ–΄ν•κΈ° μ„ν•΄ μ‚¬μ©
- Redisλ¥Ό ν™μ©ν• λ€ν‘μ μΈ λΌμ΄λΈλ¬λ¦¬: Lettuce, Redisson

---

### π”Ή Lettuce κΈ°λ° λ¶„μ‚°λ½
- `setNx` λ…λ Ήμ–΄ + TTLλ΅ λ½ νλ“ μ‹λ„
- spin-lock κΈ°λ°μΌλ΅ κ³„μ†ν•΄μ„ λ½ νλ“ μ‹λ„ β†’ CPU λ‚­λΉ„
- wake-up κ²½ν•© λ°©μ§€λ¥Ό μ„ν•΄ `jitter (λλ¤ μ§€μ—°)` μ μ© ν•„μ”

#### κµ¬ν„ λ°©μ‹ μ”μ•½
```java
while(!lockRepository.lock(id)) {
    long jitter = new Random().nextInt(50);
    Thread.sleep(50 + jitter); // 50~100ms
}
```

#### μ¥λ‹¨μ 
- β… κ°„λ‹¨ν• κµ¬ν„, Redis ν΄λΌμ΄μ–ΈνΈλ΅λ§ κµ¬ν„ κ°€λ¥
- β μ¬μ‹λ„, μμ™Έμ²λ¦¬, TTL κ΄€λ¦¬, unlock λ„λ½ λ“± μ§μ ‘ κ΄€λ¦¬ ν•„μ”
- β κ³µμ •μ„± λ³΄μ¥ μ–΄λ ¤μ›€

---

### π”Ή Redisson κΈ°λ° λ¶„μ‚°λ½
- λ‚΄λ¶€μ μΌλ΅ Lua μ¤ν¬λ¦½νΈ κΈ°λ°μΌλ΅ atomic μ—°μ‚° μ²λ¦¬
- pub-sub κΈ°λ° λ½: λ½ ν•΄μ  μ‹ λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈμ—κ² μ•λ¦Ό
- λ°±μ¤ν”„, μ¬μ‹λ„, TTL, μλ™ unlock κΈ°λ¥ λ‚΄μ¥

#### μ£Όμ” API μμ‹
```java
RLock lock = redissonClient.getLock("lock-key");
lock.tryLock(10, 1, TimeUnit.SECONDS);
```

#### κ³µμ • λ½ vs μΌλ° λ½
- μΌλ° λ½: λΉ λ¥΄μ§€λ§, λ½ μ”μ²­ μμ„κ°€ λ³΄μ¥λμ§€ μ•μ
- κ³µμ • λ½: Redis λ‚΄λ¶€μ— λ€κΈ°μ—΄μ„ λ‘κ³  μμ°¨ μ²λ¦¬ β†’ μ •ν•΄μ§„ μμ„ λ³΄μ¥  
  β†’ μΆ€λΉ„ ν΄λΌμ΄μ–ΈνΈκ°€ μμ„ κ²½μ° μ„ν—, μ¤λ²„ν—¤λ“ μ΅΄μ¬

---

## π§ μ„±λ¥ λΉ„κµ ν…μ¤νΈ

| λ°©μ‹               | μ†μ” μ‹κ°„ (ms) |
|--------------------|----------------|
| Redisson μΌλ° λ½   | 1569           |
| Redisson κ³µμ • λ½   | 2176           |
| Lettuce μ»¤μ¤ν…€ λ½  | 1830           |

---

## π§  μ •λ¦¬ λ° μΈμ‚¬μ΄νΈ
- λ³µμ΅ν•μ§€ μ•μ€ νΈλν”½μ€ **DB μμ¤€ λ½μΌλ΅ μ¶©λ¶„**
- Redis μΈν”„λΌμ™€ κ³ μ„±λ¥ ν•„μ” μ‹ β†’ **Redisson κΈ°λ° λ¶„μ‚°λ½**
- **λΉ„μ©, κ΄€λ¦¬ν¬μΈνΈ, κ³µμ •μ„± λ³΄μ¥ μ—¬λ¶€**μ— λ”°λΌ μ„ νƒ ν•„μ”

# Today I Learned  
# Executor, ExecutorService, ThreadPoolExecutor ì •ë¦¬  
# 2025-06-09  

## ğŸ“š ê³µë¶€í•œ ë‚´ìš©  
- ìë°”ì˜ `Executor` ë° `ExecutorService` ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°  
- `Executors` ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤  
- ìŠ¤ë ˆë“œí’€ ì¢…ë¥˜ ë° íŠ¹ì§•  
- í†°ìº£ ë‚´ì¥ ìŠ¤ë ˆë“œí’€ êµ¬í˜„ì²´ í™•ì¸
- NIOì™€ BIOì˜ ì°¨ì´  
- Spring Bootì˜ ThreadPool ì„¤ì •

## ğŸ’¡ ì£¼ìš” ê°œë…  

### Executor  
- ì‘ì—… ì‹¤í–‰ ì±…ì„ë§Œ ìˆìŒ. `execute(Runnable command)` ë©”ì„œë“œ í•˜ë‚˜ë§Œ ìˆìŒ.  
- ì§ì ‘ `Thread` ìƒì„± ì—†ì´ ì‘ì—…ì„ ìœ„ì„í•  ìˆ˜ ìˆê²Œ ì¶”ìƒí™”í•œ ì¸í„°í˜ì´ìŠ¤.

### ExecutorService  
- Executor í™•ì¥ ì¸í„°í˜ì´ìŠ¤ë¡œ submit, shutdown, invokeAll ë“± ë‹¤ì–‘í•œ ì‘ì—… ê´€ë¦¬ ì œê³µ.  
- ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‘ì—…ì„ íì‰í•˜ê³ , ì‹¤í–‰í•˜ê³ , ì¢…ë£Œê¹Œì§€ ì±…ì„ì§.

### Executors ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤  
| ë©”ì„œë“œ | ì„¤ëª… | íŠ¹ì§• | ì í•©í•œ ìƒí™© |
|--------|------|------|-------------|
| `newFixedThreadPool(n)` | ê³ ì • í¬ê¸° ìŠ¤ë ˆë“œ í’€ | ì˜ˆì¸¡ ê°€ëŠ¥ / ì‘ì—… íì— ì €ì¥ | ì¼ì •ëŸ‰ ì‘ì—… ë°˜ë³µ |
| `newCachedThreadPool()` | ë™ì  í¬ê¸° ìŠ¤ë ˆë“œ í’€ | ë¹ ë¥¸ ì‘ë‹µ / ë©”ëª¨ë¦¬ ë¶€í•˜ ê°€ëŠ¥ | ë‹¨ê¸° ê³ ë¹ˆë„ ì‘ì—… |
| `newSingleThreadExecutor()` | í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì‚¬ìš© | ìˆœì°¨ ì‹¤í–‰ ë³´ì¥ | ì§ë ¬ ì‘ì—… |
| `newScheduledThreadPool(n)` | ìŠ¤ì¼€ì¤„ë§ ì§€ì› | ì£¼ê¸° ì‹¤í–‰ ê°€ëŠ¥ | íƒ€ì´ë¨¸, ì£¼ê¸° ì‘ì—… |
| `newWorkStealingPool()` | ForkJoinPool ê¸°ë°˜ | ë³‘ë ¬ ì²˜ë¦¬ ìë™ ì¡°ì ˆ | ëŒ€ëŸ‰ ë¹„ë™ê¸° ì‘ì—… |

### í†°ìº£ ìŠ¤ë ˆë“œí’€ (Spring Boot ë‚´ì¥)  
- `org.apache.tomcat.util.threads.ThreadPoolExecutor` ì‚¬ìš©  
- `setMaxThreads`, `setMinSpareThreads`, `setAcceptCount`ë¡œ ì„¤ì • ê°€ëŠ¥  
- NIO ê¸°ë°˜ ì»¤ë„¥í„° `Http11NioProtocol` ì‚¬ìš©  

```java
@Configuration
public class TomcatConfig {
    @Bean
    public WebServerFactoryCustomizer<TomcatServletWebServerFactory> tomcatCustomizer() {
        return factory -> factory.addConnectorCustomizers(connector -> {
            ProtocolHandler handler = connector.getProtocolHandler();
            if (handler instanceof AbstractHttp11Protocol<?> protocol) {
                protocol.setMaxThreads(200);
                protocol.setMinSpareThreads(10);
                protocol.setAcceptCount(100);
            }
        });
    }
}
```

### BIO vs NIO  

| êµ¬ë¶„ | BIO | NIO |
|------|-----|-----|
| ëª¨ë¸ | 1 thread : 1 connection | 1 thread : N connection |
| ì²˜ë¦¬ ë°©ì‹ | blocking | non-blocking (Selector ê¸°ë°˜) |
| íŠ¹ì§• | ì“°ë ˆë“œ ë‚­ë¹„, ì§ê´€ì  | íš¨ìœ¨ì , ë³µì¡í•¨ |
| Spring Boot | ê¸°ë³¸: NIO ì‚¬ìš© (`Http11NioProtocol`) |

### ì‹¤ì œ ìŠ¤ë ˆë“œí’€ ì‹¤í–‰ ë¡œì§  
- ê¸°ë³¸ì ìœ¼ë¡œ `ThreadPoolExecutor`ë¥¼ ìƒì†í•œ í†°ìº£ ìì²´ êµ¬í˜„ ì‚¬ìš©  
- TaskQueue, Context reload ì‹œ ìŠ¤ë ˆë“œ ì¢…ë£Œ, queue full ì‹œ ê±°ë¶€ ì •ì±… ì„¤ì • ë“± ë‚´ì¥  

### ì‹¤ë¬´ í¬ì¸íŠ¸  
- CPU ë°”ìš´ë“œ ì‘ì—… â†’ fixedThreadPool  
- IO ë°”ìš´ë“œ ì‘ì—… â†’ cachedThreadPool ë˜ëŠ” virtualThreadPerTaskExecutor  
- í†°ìº£/ì„œë²„ ì„¤ì •ì€ í…ŒìŠ¤íŠ¸ì™€ ëª¨ë‹ˆí„°ë§ í†µí•´ ìµœì ê°’ ë„ì¶œ  
- `@ConditionalOnMissingBean`ìœ¼ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥

## ğŸ”— ì°¸ê³   
- https://new-think-think.tistory.com/28
- https://hyokeun0419.tistory.com/entry/Thread-Pool-Java-Tomcat-SpringBoot  
- https://strong-park.tistory.com/entry/Executor-ExecutorService-Executors-ë™ì‘ì›ë¦¬

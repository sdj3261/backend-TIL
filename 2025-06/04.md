# Today I Learned  
# 2025-06-04  

## ğŸ“š ê³µë¶€í•œ ë‚´ìš©  
- ìˆœìˆ˜ ìë°”ì—ì„œì˜ DI ì„¤ê³„ â†’ ìŠ¤í”„ë§ DI ì»¨í…Œì´ë„ˆë¡œì˜ ì „í™˜  
- IoCì™€ DI, í”„ë¡ì‹œ ê¸°ë°˜ì˜ Spring Bean ê´€ë¦¬  
- CGLIB ë™ì‘ ë°©ì‹, í”„ë¡ì‹œ ìƒì„± ëª©ì ê³¼ ì‹¤ë¬´ ì´ì   
- ë¦¬í”Œë ‰ì…˜ê³¼ ë©”ì„œë“œ ì¸í„°ì…‰í„° í™œìš© ì´ìœ   

## ğŸ’¡ ì£¼ìš” ê°œë…ë“¤  

### ìˆœìˆ˜ Java ë°©ì‹ì˜ DI  
- AppConfigê°€ ì§ì ‘ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì˜ì¡´ê´€ê³„ë¥¼ ì—°ê²°í•¨  
- ì¶”ìƒí™”ì— ì˜ì¡´í•˜ê³ , êµ¬í˜„ì²´ëŠ” ì™¸ë¶€ì—ì„œ ì£¼ì…í•˜ì—¬ **í´ë˜ìŠ¤ ì±…ì„ ë¶„ë¦¬, ë³€ê²½ì— ìœ ì—°**  

```java
public class AppConfig {
    public MemberService memberService() {
        return new MemberServiceImpl(getMemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(getMemoryMemberRepository(), discountPolicy());
    }

    private MemoryMemberRepository getMemoryMemberRepository() {
        return new MemoryMemberRepository();
    }

    public DiscountPolicy discountPolicy() {
        return new FixDisCountPolicy();
    }
}
```

---

## IoC ì»¨í…Œì´ë„ˆë€?  
- **Inversion of Control (ì œì–´ì˜ ì—­ì „)**  
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íë¦„ ì œì–´ë¥¼ ê°œë°œìê°€ ì•„ë‹Œ **ì»¨í…Œì´ë„ˆê°€ ì œì–´**  
- DIëŠ” IoCë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì´ë©°, ê°ì²´ ìƒì„±/ê´€ë¦¬ë¥¼ ì™¸ë¶€ë¡œ ìœ„ì„í•¨

---

## ìŠ¤í”„ë§ì˜ DI ë°©ì‹  
- `@Configuration`, `@Bean`ì„ ì‚¬ìš©í•˜ì—¬ ê°ì²´ ë“±ë¡  
- `ApplicationContext`ë¡œ ê´€ë¦¬ëœ Beanì„ ì£¼ì… ë° ì¡°íšŒ  

```java
@Configuration
public class AppConfig {
    @Bean
    public MemberService memberService() {
        return new MemberServiceImpl(getMemoryMemberRepository());
    }

    @Bean
    public MemoryMemberRepository getMemoryMemberRepository() {
        return new MemoryMemberRepository();
    }
}
```

- `ApplicationContext`ëŠ” Beanì„ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ì¬ì‚¬ìš© ìµœì í™”

---

## CGLIB í”„ë¡ì‹œ í´ë˜ìŠ¤ì˜ ì—­í•   
- Springì€ `AppConfig`ë¥¼ CGLIBìœ¼ë¡œ ìƒì†í•˜ì—¬ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ìƒì„±  
- @Bean ë©”ì„œë“œê°€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë˜ì–´ë„ í•­ìƒ **ê°™ì€ ê°ì²´ë¥¼ ë°˜í™˜** (ì‹±ê¸€í†¤ ë³´ì¥)  
- FastClassì™€ MethodInterceptorë¥¼ í†µí•´ ë¦¬í”Œë ‰ì…˜ë³´ë‹¤ ë¹ ë¥¸ ì„±ëŠ¥ í™•ë³´  

```java
public final MemberService memberService() {
    MethodInterceptor interceptor = this.CGLIB$CALLBACK_0;
    return interceptor != null ? (MemberService) interceptor.intercept(...) : super.memberService();
}
```

### FastClass
- ë©”ì„œë“œë¥¼ ë°°ì—´ ì¸ë±ìŠ¤ë¡œ ë§¤í•‘í•˜ì—¬ switch ë¬¸ìœ¼ë¡œ í˜¸ì¶œ â†’ ë¦¬í”Œë ‰ì…˜ ëŒ€ë¹„ ë¹ ë¦„  

---

## ì‹±ê¸€í†¤ ê´€ë¦¬ ë°©ì‹  
- DefaultSingletonBeanRegistry ë‚´ë¶€ì—ì„œ ì‹±ê¸€í†¤ìœ¼ë¡œ ëª¨ë“  ë¹ˆì„ ê°ì²´ ìºì‹±í•œë‹¤. ConcurrentHashMap  

```java
private final Map<String, Object> singletonObjects = new ConcurrentHashMap<>(256);
```

- ë©”ì„œë“œ í˜¸ì¶œì„ ì¸í„°ì…‰íŠ¸í•˜ì—¬ ì´ë¯¸ ìƒì„±ëœ Beanì´ë©´ ìºì‹œì—ì„œ ë°˜í™˜, ì—†ìœ¼ë©´ ìƒì„± í›„ ë“±ë¡  

---

## BeanFactoryPostProcessorì—ì„œ staticì´ í•„ìš”í•œ ì´ìœ   
- `@Bean` ë©”ì„œë“œê°€ BeanFactoryPostProcessorì™€ ê°™ì€ ì´ˆê¸°ë‹¨ê³„ ì‹¤í–‰ ê°ì²´ë¥¼ ìƒì„±í•  ê²½ìš°  
- `@Configuration` í´ë˜ìŠ¤ê°€ ì™„ì „íˆ ìƒì„±ë˜ê¸° ì „ì—ë„ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•˜ë¯€ë¡œ `static` í•„ìš”

---

## ì‹¤ë¬´ì—ì„œ ì´ êµ¬ì¡°ë¥¼ ì¨ì•¼ í•˜ëŠ” ì´ìœ   
1. **ë³€ê²½ì— ìœ ì—°**: êµ¬í˜„ì²´ êµì²´ ì‹œ `AppConfig`ë§Œ ìˆ˜ì •í•˜ë©´ ë¨  
2. **í…ŒìŠ¤íŠ¸ ìš©ì´**: Mock Beanì„ ì£¼ì…í•˜ê±°ë‚˜ êµì²´ ê°€ëŠ¥  
3. **ì„±ëŠ¥ ìµœì í™”**: ì‹±ê¸€í†¤ ê´€ë¦¬, ë¦¬í”Œë ‰ì…˜ ìµœì†Œí™”  
4. **AOP ì ìš© ê°€ëŠ¥**: í”„ë¡ì‹œ ê¸°ë°˜ì´ë¯€ë¡œ ë¶€ê°€ê¸°ëŠ¥ ì‚½ì… ì‰¬ì›€  

---

## ë¦¬í”Œë ‰ì…˜ì´ ëŠë¦° ì´ìœ   
- ëŸ°íƒ€ì„ì— ë©”ì„œë“œ ì •ë³´ë¥¼ ë¬¸ìì—´ë¡œ íƒìƒ‰í•´ì•¼ í•˜ë¯€ë¡œ ì˜¤ë²„í—¤ë“œê°€ í¬ë‹¤.
---

## ğŸ”— ì°¸ê³   
- https://new-think-think.tistory.com/19

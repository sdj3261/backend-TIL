
# [DB] 성능을 좌우하는 DB

📅 날짜: 2025-06-18

---

## 📚 공부한 내용

DB의 성능을 좌우하는 요소들인 인덱스, 정규화/비정규화, 페이징 전략, 파티셔닝, 샤딩, 캐시, 통계 갱신 및 복제본 사용 등 다양한 관점에서 데이터베이스 성능 최적화 기법을 학습했다.

---

## 💡 주요 개념들

### 📌 인덱스란?
- 사전처럼 특정 컬럼 값을 기준으로 정렬하여 데이터 위치를 빠르게 찾아감.
- 인덱스를 사용하면 SELECT 성능이 증가하지만, INSERT/UPDATE 시 오버헤드 발생.
- MySQL에서는 `EXPLAIN`으로 실행계획을 확인할 수 있음.

### 📌 복합 인덱스
- 다중 컬럼 인덱스.
- 데이터 분포에 따라 userId만으로는 충분치 않아 `userId + activityDate`를 복합 인덱스로 설정하면 효율 증가.
- 자주 사용하는 필드에는 covering index를 고려.

### 📌 선택도가 높은 컬럼
- 고유값이 많을수록 인덱스 성능이 좋아짐.
- M/F 처럼 값이 두 개뿐이면 효과 적음.

### 📌 인덱스 없이 성능 개선
#### ✅ 비정규화
- JOIN을 줄이고 조회 성능을 높이기 위해 중복 저장 허용.
- 사전 집계 데이터 저장 (게시글 수, 댓글 수 등).

### 📌 페이징 성능
- `OFFSET`은 페이지가 뒤로 갈수록 느려짐.
- `id < ?` 형식으로 커서 기반 페이징 권장.

### 📌 날짜 범위 조회 최적화
- `WHERE DATE(created_at)` → 인덱스 못 씀
- `WHERE created_at BETWEEN` → 인덱스 활용 가능

### 📌 COUNT(*) 비용
- 대량 데이터에서는 비용 큼.
- 캐싱하거나 사전 집계 필요.

### 📌 테이블 통계 갱신
- `ANALYZE TABLE` : 옵티마이저가 최신 통계로 실행 계획 수립
- `OPTIMIZE TABLE` : 디스크 파편화 정리 (주의: 온라인 DDL 아님)

### 📌 복제본 DB 사용
- 읽기 요청을 분산.
- Primary-Replica 구조로 CPU 부하 완화.

### 📌 파티셔닝 vs 샤딩
| 구분 | 파티셔닝 | 샤딩 |
|------|----------|-------|
| 정의 | 단일 테이블을 내부 논리 분할 | 데이터베이스 자체를 물리적으로 분산 |
| 위치 | 하나의 DB 안 | 여러 DB 인스턴스 |
| 관리 | DBMS | 애플리케이션 직접 라우팅 |

샤딩 방식:
- 해시 기반
- 범위 기반
- 디렉터리 기반

### 📌 DB 시간 타입과 함수
- TIMESTAMP: UTC 변환 → 표시 시 로컬
- DATETIME: 고정 타임존 저장
- 함수: `NOW()`, `DATE_FORMAT()`, `UNIX_TIMESTAMP()`, 등

---

## 🔗 참고

- https://product.kyobobook.co.kr/detail/S000216376461
